using HappyHotel.Buff.Settings;
using HappyHotel.Core.BehaviorComponent;
using HappyHotel.Equipment.Templates;
using HappyHotel.Prop.Components;
using UnityEngine;

namespace HappyHotel.Prop
{
    // 攻击易伤护符+ Prop
    [AutoInitComponent(typeof(BuffAdderComponent))]
    public class OnHitVulnerabilityCharmPlusProp : EquipmentPropBase
    {
        protected override void OnTemplateSet()
        {
            base.OnTemplateSet();

            var buffAdder = GetBehaviorComponent<BuffAdderComponent>();
            if (buffAdder != null)
            {
                buffAdder.SetBuffType("AttackOnHitVulnerability");

                var layers = 1;
                if (template is OnHitVulnerabilityCharmTemplate t) layers = Mathf.Max(1, t.onHitLayers);
                var setting = new AttackOnHitVulnerabilitySetting(layers);
                buffAdder.SetBuffSetting(setting);
            }
        }

        protected override string FormatDescriptionInternal(string formattedDescription)
        {
            var layers = 1;
            if (template is OnHitVulnerabilityCharmTemplate t) layers = Mathf.Max(1, t.onHitLayers);
            return formattedDescription.Replace("{layer}", layers.ToString());
        }
    }
}