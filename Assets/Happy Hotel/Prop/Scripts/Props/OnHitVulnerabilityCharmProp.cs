using HappyHotel.Buff.Settings;
using HappyHotel.Core.BehaviorComponent;
using HappyHotel.Equipment.Templates;
using HappyHotel.Prop.Components;
using UnityEngine;

namespace HappyHotel.Prop
{
    // 攻击易伤护符Prop：被触发时给触发者添加“本回合攻击对目标附加易伤”的Buff
    [AutoInitComponent(typeof(BuffAdderComponent))]
    public class OnHitVulnerabilityCharmProp : EquipmentPropBase
    {
        protected override void OnTemplateSet()
        {
            base.OnTemplateSet();

            var buffAdder = GetBehaviorComponent<BuffAdderComponent>();
            if (buffAdder != null)
            {
                // 绑定要添加的OnHit型Buff的typeId
                buffAdder.SetBuffType("AttackOnHitVulnerability");

                var layers = 1;
                if (template is OnHitVulnerabilityCharmTemplate t) layers = Mathf.Max(1, t.onHitLayers);
                // 使用专用 Setting 传递“每击给目标添加的易伤层数”
                var setting = new AttackOnHitVulnerabilitySetting(layers);
                buffAdder.SetBuffSetting(setting);
            }
        }

        protected override string FormatDescriptionInternal(string formattedDescription)
        {
            var layers = 1;
            if (template is OnHitVulnerabilityCharmTemplate t) layers = Mathf.Max(1, t.onHitLayers);
            return formattedDescription.Replace("{layer}", layers.ToString());
        }
    }
}


